<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - êµìœ¡ ê³¼ì • ë“±ë¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800">

    <div class="max-w-6xl mx-auto py-10 px-4">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-8 pb-4">ğŸ“ êµìœ¡ ê³¼ì • ê´€ë¦¬ (ê´€ë¦¬ì)</h1>

            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="flex border-b border-gray-200 mb-8">
                <button onclick="switchTab('register')" id="tab-register"
                    class="py-2 px-4 text-blue-600 border-b-2 border-blue-600 font-bold focus:outline-none transition-colors">
                    êµìœ¡ ê³¼ì • ë“±ë¡
                </button>
                <button onclick="switchTab('status')" id="tab-status"
                    class="py-2 px-4 text-gray-500 font-medium hover:text-gray-700 focus:outline-none transition-colors">
                    ì‹ ì²­ì í˜„í™©
                </button>
            </div>

            <!-- ì„¹ì…˜ 1: êµìœ¡ ê³¼ì • ë“±ë¡ (ê¸°ì¡´ í¼) -->
            <div id="section-register">
                <form id="courseForm" class="space-y-6">

                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬</label>
                            <select id="category"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 font-medium">
                                <option value="ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì„¸ë¬´/íšŒê³„">ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì„¸ë¬´/íšŒê³„</option>
                                <option value="ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì¸ì‚¬/ë…¸ë¬´">ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì¸ì‚¬/ë…¸ë¬´</option>
                                <option value="ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ê²½ì˜ì¼ë°˜">ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ê²½ì˜ì¼ë°˜</option>
                                <option value="ì¬ì§ì AI êµìœ¡">ì¬ì§ì AI êµìœ¡</option>
                                <option value="FTA ì‹¤ë¬´ êµìœ¡">FTA ì‹¤ë¬´ êµìœ¡</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="adminPassword" required placeholder="ìŠ¤í¬ë¦½íŠ¸ì— ì„¤ì •ëœ ë¹„ë°€ë²ˆí˜¸"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-red-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ê³¼ì •ëª… (Title)</label>
                        <input type="text" id="title" required
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: 2025ë…„ ì œ1ì°¨ ì›ì‚°ì§€ ê´€ë¦¬ ì‹¤ë¬´">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì¼ì‹œ (Date Text)</label>
                            <input type="text" id="date" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: 2025. 3. 14(ëª©) 14:00~18:00">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì¥ì†Œ (Place)</label>
                            <input type="text" id="place" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: ëŒ€êµ¬ìƒê³µíšŒì˜ì†Œ 4ì¸µ ì¤‘íšŒì˜ì‹¤2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì •ì› (Capacity)</label>
                            <input type="number" id="capacity" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: 40">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì‹ ì²­ ê¸°í•œ (Deadline)</label>
                            <input type="date" id="deadline" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- ìƒì„¸ ì •ë³´ -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">êµìœ¡ ëŒ€ìƒ (Target)</label>
                        <input type="text" id="target"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: ì§€ì—­ê¸°ì—… ì„ì§ì› ë“±">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">êµìœ¡ ëª©í‘œ (Goal)</label>
                        <textarea id="goal" rows="3"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="êµìœ¡ì˜ ëª©ì  ë° ê¸°ëŒ€íš¨ê³¼"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ì£¼ìš” ë‚´ìš© (Content)</label>
                        <textarea id="content" rows="5" required
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="- ë‚´ìš© 1&#10;- ë‚´ìš© 2&#10;- ë‚´ìš© 3"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ê°•ì‚¬ (Instructor)</label>
                            <input type="text" id="instructor"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì†Œì† ë° ì„±ëª…">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ë¬¸ì˜ì²˜ (Contact)</label>
                            <input type="text" id="contact"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: ê¸°ì—…ì§€ì›ë¶€ (053-222-3109)">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">êµìœ¡ë¹„ ì•ˆë‚´ (Payment Info)</label>
                        <textarea id="paymentInfo" rows="2"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: ë¬´ë£Œ (êµì¬ ë° ìˆ˜ë£Œì¦ ì œê³µ)"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ê¸°íƒ€ ì•ˆë‚´ (Other Info)</label>
                        <textarea id="otherInfo" rows="2"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: ì£¼ì°¨ì¥ì´ í˜‘ì†Œí•˜ì˜¤ë‹ˆ ëŒ€ì¤‘êµí†µì„ ì´ìš©í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤."></textarea>
                    </div>

                    <div class="pt-6 border-t flex justify-end">
                        <button type="button" onclick="submitCourse()"
                            class="px-8 py-3 bg-blue-900 text-white font-bold rounded-xl shadow hover:bg-blue-800 transition-colors transform hover:-translate-y-0.5">
                            ê³¼ì • ë“±ë¡í•˜ê¸°
                        </button>
                    </div>

                </form>
            </div>

            <!-- ì„¹ì…˜ 2: ì‹ ì²­ì í˜„í™© (ì‹ ê·œ) -->
            <div id="section-status" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">ğŸ“Š í˜„ì¬ ì ‘ìˆ˜ì¤‘ì¸ êµìœ¡ê³¼ì • í˜„í™©</h2>
                        <p class="text-sm text-gray-500 mt-1">í˜„ì¬ ì ‘ìˆ˜ ì¤‘ì´ê±°ë‚˜ ë§ˆê° ì„ë°•í•œ ê³¼ì •ì˜ ì‹ ì²­ í˜„í™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="fetchStatus()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-bold">
                        â†» ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
                
                <div class="overflow-x-auto border rounded-xl">
                    <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                                <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ê³¼ì •ëª…</th>
                                <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ì¼ì‹œ</th>
                                <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">í˜„í™© (ì‹ ì²­/ì •ì›)</th>
                                <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ì‹ ì²­ê¸°í•œ</th>
                            </tr>
                        </thead>
                        <tbody id="status-body" class="bg-white divide-y divide-gray-200 text-sm">
                            <tr>
                                <td colspan="5" class="px-6 py-10 text-center text-gray-500">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ 'ìƒˆë¡œê³ ì¹¨' ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ íƒ­ì„ ë‹¤ì‹œ í´ë¦­í•˜ì„¸ìš”.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        // â˜…â˜…â˜… index.htmlê³¼ ë™ì¼í•œ URL ì‚¬ìš© â˜…â˜…â˜…
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwHAGck5vVpCIMmmfQcvlxX4TTKGjt6CC9Z9stc9qcC3o9oFraE6z_VDOobjH9oPK4q1A/exec';

        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function switchTab(tabId) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.getElementById('tab-register').className = "py-2 px-4 text-gray-500 font-medium hover:text-gray-700 focus:outline-none transition-colors";
            document.getElementById('tab-register').classList.remove('border-b-2', 'border-blue-600', 'text-blue-600');
            
            document.getElementById('tab-status').className = "py-2 px-4 text-gray-500 font-medium hover:text-gray-700 focus:outline-none transition-colors";
            document.getElementById('tab-status').classList.remove('border-b-2', 'border-blue-600', 'text-blue-600');

            // ì„ íƒëœ íƒ­ ìŠ¤íƒ€ì¼ ì ìš©
            const activeClass = "text-blue-600 border-b-2 border-blue-600 font-bold".split(' ');
            document.getElementById('tab-' + tabId).classList.add(...activeClass);
            document.getElementById('tab-' + tabId).classList.remove('text-gray-500', 'font-medium');

            // ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            document.getElementById('section-register').classList.add('hidden');
            document.getElementById('section-status').classList.add('hidden');
            document.getElementById('section-' + tabId).classList.remove('hidden');

            // í˜„í™© íƒ­ í´ë¦­ ì‹œ ë°ì´í„° ë¡œë“œ
            if (tabId === 'status') {
                fetchStatus();
            }
        }

        // í˜„í™© ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function fetchStatus() {
            const tbody = document.getElementById('status-body');
            tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center text-blue-600 font-bold"><span class="animate-pulse">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span></td></tr>';

            fetch(scriptURL)
                .then(response => response.json())
                .then(data => {
                    tbody.innerHTML = '';
                    if (data.result === 'error') {
                        tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500 font-bold">ì˜¤ë¥˜: ${data.msg}</td></tr>`;
                        return;
                    }

                    const now = new Date();
                    let hasData = false;

                    // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜ í›„ ì •ë ¬ (ì ‘ìˆ˜ì¤‘ ìš°ì„ , ë‚ ì§œìˆœ)
                    const courses = Object.keys(data).map(key => data[key]);
                    
                    // ì ‘ìˆ˜ì¤‘ì¸ ê³¼ì •ë§Œ í•„í„°ë§ (ì›í•˜ë©´ ëª¨ë“  ê³¼ì • ë³´ê¸°ë¡œ ë³€ê²½ ê°€ëŠ¥)
                    courses.forEach(item => {
                        // ë‚ ì§œ ë° ìƒíƒœ ê³„ì‚°
                        let statusBadge = `<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded-full">ì ‘ìˆ˜ì¤‘</span>`;
                        const cap = parseInt(item.capacity || 0);
                        const cur = parseInt(item.current || 0);
                        let isFull = false;

                        if (cap > 0 && cur >= cap) { 
                            isFull = true; 
                            statusBadge = `<span class="px-2 py-1 bg-gray-100 text-gray-500 text-xs font-bold rounded-full">ì •ì›ë§ˆê°</span>`; 
                        }
                        
                        let isExpired = false;
                        if (item.deadline) {
                            const deadlineDate = new Date(item.deadline);
                            deadlineDate.setHours(23, 59, 59, 999);
                            if (now > deadlineDate) { 
                                isExpired = true;
                                statusBadge = `<span class="px-2 py-1 bg-gray-100 text-gray-500 text-xs font-bold rounded-full">ê¸°í•œë§ˆê°</span>`; 
                            }
                        }

                        // ì ‘ìˆ˜ì¤‘ì´ê±°ë‚˜, ë§ˆê°ë˜ì—ˆì§€ë§Œ ìµœê·¼ì¸ ê²ƒë“¤ ë“± ì •ì±…ì— ë”°ë¼ í•„í„°ë§ ê°€ëŠ¥. 
                        // ì¼ë‹¨ì€ ëª¨ë“  ëª©ë¡ì„ ë³´ì—¬ì£¼ë˜ ì •ë ¬ì„ 'ì ‘ìˆ˜ì¤‘'ì´ ìœ„ë¡œ ì˜¤ê²Œ í•  ìˆ˜ë„ ìˆìœ¼ë‚˜, ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœ ë¦¬ìŠ¤íŠ¸ì—….
                        
                        // ì‚¬ìš©ìì˜ ìš”ì²­: "í˜„ì¬ ì ‘ìˆ˜ì¤‘ì¸ êµìœ¡ê³¼ì •, ì ‘ìˆ˜ì¤‘ì¸ êµìœ¡ê³¼ì •ì— ì‹ ì²­ì í˜„í™©ì„ í•œë²ˆì— ë³¼ìˆ˜ìˆëŠ” í˜ì´ì§€"
                        // ë”°ë¼ì„œ ì ‘ìˆ˜ ì¢…ë£Œëœ ê±´ êµ³ì´ ì•ˆ ë³´ì—¬ì¤˜ë„ ë˜ì§€ë§Œ, ì¼ë‹¨ ë‹¤ ë³´ì—¬ì£¼ê³  ìƒíƒœ ë±ƒì§€ë¡œ êµ¬ë¶„.

                        hasData = true;

                        const row = `
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4">${statusBadge}</td>
                                <td class="px-6 py-4">
                                    <div class="text-sm font-bold text-gray-900">${item.title}</div>
                                    <div class="text-xs text-gray-500">${item.category}</div>
                                </td>
                                <td class="px-6 py-4 text-gray-500 text-sm">${item.date}</td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div class="w-full bg-gray-200 rounded-full h-2.5 mr-2 max-w-[100px]">
                                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${cap > 0 ? Math.min((cur/cap)*100, 100) : 0}%"></div>
                                        </div>
                                        <span class="text-sm font-bold text-gray-700">${cur} / ${cap > 0 ? cap : '-'}ëª…</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-gray-500 text-sm">
                                    ${item.deadline ? item.deadline.split('T')[0] : 'ìƒì‹œ/ë³„ë„'}
                                </td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });

                    if (!hasData) {
                        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center text-gray-500">í˜„ì¬ í‘œì‹œí•  êµìœ¡ ê³¼ì • ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ (ê´€ë¦¬ì ë¬¸ì˜)</td></tr>`;
                });
        }

        function submitCourse() {
            const btn = document.querySelector('button[onclick="submitCourse()"]');
            const originalText = btn.innerText;

            if (!confirm("ì´ëŒ€ë¡œ êµìœ¡ ê³¼ì •ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            btn.innerText = "ì²˜ë¦¬ ì¤‘...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append('action', 'add_course');
            formData.append('password', document.getElementById('adminPassword').value);

            formData.append('category', document.getElementById('category').value);
            formData.append('title', document.getElementById('title').value);
            formData.append('date', document.getElementById('date').value);
            formData.append('place', document.getElementById('place').value);
            formData.append('capacity', document.getElementById('capacity').value);
            formData.append('deadline', document.getElementById('deadline').value);
            formData.append('target', document.getElementById('target').value);
            formData.append('goal', document.getElementById('goal').value);
            formData.append('content', document.getElementById('content').value);
            formData.append('instructor', document.getElementById('instructor').value);
            formData.append('contact', document.getElementById('contact').value);
            formData.append('paymentInfo', document.getElementById('paymentInfo').value);
            formData.append('otherInfo', document.getElementById('otherInfo').value);

            const data = new URLSearchParams(formData);

            fetch(scriptURL, { method: 'POST', body: data })
                .then(response => response.json())
                .then(result => {
                    if (result.result === 'success') {
                        alert('âœ… êµìœ¡ ê³¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        document.getElementById('courseForm').reset();
                    } else {
                        alert('â›” ë“±ë¡ ì‹¤íŒ¨: ' + result.msg);
                    }
                    btn.innerText = originalText;
                    btn.disabled = false;
                })
                .catch(error => {
                    alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    console.error(error);
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - êµìœ¡ ê³¼ì • ë“±ë¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800">

    <div class="max-w-6xl mx-auto py-10 px-4">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-8 pb-4">ğŸ“ êµìœ¡ ê³¼ì • ê´€ë¦¬ (ê´€ë¦¬ì)</h1>

            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="flex border-b border-gray-200 mb-8">
                <button onclick="switchTab('status')" id="tab-status"
                    class="py-2 px-4 text-blue-600 border-b-2 border-blue-600 font-bold focus:outline-none transition-colors">
                    ì‹ ì²­ì í˜„í™©
                </button>
                <button onclick="switchTab('register')" id="tab-register"
                    class="py-2 px-4 text-gray-500 font-medium hover:text-gray-700 focus:outline-none transition-colors">
                    êµìœ¡ ê³¼ì • ë“±ë¡
                </button>
                <button onclick="switchTab('manage')" id="tab-manage"
                    class="py-2 px-4 text-gray-500 font-medium hover:text-gray-700 focus:outline-none transition-colors">
                    êµìœ¡ ê³¼ì • ê´€ë¦¬ (ìˆ˜ì •/ì‚­ì œ)
                </button>
            </div>

            <!-- ì„¹ì…˜ 1: ì‹ ì²­ì í˜„í™© -->
            <div id="section-status">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">ğŸ“Š í˜„ì¬ ì ‘ìˆ˜ì¤‘ì¸ êµìœ¡ê³¼ì • í˜„í™©</h2>
                        <p class="text-sm text-gray-500 mt-1">í˜„ì¬ ì ‘ìˆ˜ ì¤‘ì´ê±°ë‚˜ ë§ˆê° ì„ë°•í•œ ê³¼ì •ì˜ ì‹ ì²­ í˜„í™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="fetchStatus()"
                        class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-bold">
                        â†» ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>

                <div class="overflow-x-auto border rounded-xl">
                    <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
                        <thead class="bg-gray-50">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ìƒíƒœ</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ê³¼ì •ëª…</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ì¼ì‹œ</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    í˜„í™© (ì‹ ì²­/ì •ì›)</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ì‹ ì²­ê¸°í•œ</th>
                            </tr>
                        </thead>
                        <tbody id="status-body" class="bg-white divide-y divide-gray-200 text-sm">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì„¹ì…˜ 2: êµìœ¡ ê³¼ì • ë“±ë¡ (ê¸°ì¡´ í¼) -->
            <div id="section-register" class="hidden">
                <div id="edit-header" class="hidden mb-4 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <div class="flex justify-between items-center">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    í˜„ì¬ <span id="edit-course-title" class="font-bold"></span> ê³¼ì •ì„ ìˆ˜ì • ì¤‘ì…ë‹ˆë‹¤.
                                </p>
                            </div>
                        </div>
                        <button onclick="cancelEdit()"
                            class="text-sm font-bold text-yellow-700 hover:text-yellow-900 underline">ì·¨ì†Œ (ìƒˆ ë“±ë¡ìœ¼ë¡œ
                            ì „í™˜)</button>
                    </div>
                </div>

                <form id="courseForm" class="space-y-6">

                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬</label>
                            <select id="category"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 font-medium">
                                <option value="ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì„¸ë¬´/íšŒê³„">ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì„¸ë¬´/íšŒê³„</option>
                                <option value="ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì¸ì‚¬/ë…¸ë¬´">ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ì¸ì‚¬/ë…¸ë¬´</option>
                                <option value="ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ê²½ì˜ì¼ë°˜">ì‹¤ë¬´ì ì—­ëŸ‰ê°•í™” êµìœ¡ > ê²½ì˜ì¼ë°˜</option>
                                <option value="ì¬ì§ì AI êµìœ¡">ì¬ì§ì AI êµìœ¡</option>
                                <option value="FTA ì‹¤ë¬´ êµìœ¡">FTA ì‹¤ë¬´ êµìœ¡</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="adminPassword" required placeholder="ìŠ¤í¬ë¦½íŠ¸ì— ì„¤ì •ëœ ë¹„ë°€ë²ˆí˜¸"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-red-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ê³¼ì •ëª… (Title)</label>
                        <input type="text" id="title" required
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: 2025ë…„ ì œ1ì°¨ ì›ì‚°ì§€ ê´€ë¦¬ ì‹¤ë¬´">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì¼ì‹œ (Date Text)</label>
                            <input type="text" id="date" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: 2025. 3. 14(ëª©) 14:00~18:00">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì¥ì†Œ (Place)</label>
                            <input type="text" id="place" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: ëŒ€êµ¬ìƒê³µíšŒì˜ì†Œ 4ì¸µ ì¤‘íšŒì˜ì‹¤2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì •ì› (Capacity)</label>
                            <input type="number" id="capacity" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: 40">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ì‹ ì²­ ê¸°í•œ (Deadline)</label>
                            <input type="date" id="deadline" required
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- ìƒì„¸ ì •ë³´ -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">êµìœ¡ ëŒ€ìƒ (Target)</label>
                        <input type="text" id="target"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: ì§€ì—­ê¸°ì—… ì„ì§ì› ë“±">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">êµìœ¡ ëª©í‘œ (Goal)</label>
                        <textarea id="goal" rows="3"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="êµìœ¡ì˜ ëª©ì  ë° ê¸°ëŒ€íš¨ê³¼"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ì£¼ìš” ë‚´ìš© (Content)</label>
                        <textarea id="content" rows="5" required
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="- ë‚´ìš© 1&#10;- ë‚´ìš© 2&#10;- ë‚´ìš© 3"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ê°•ì‚¬ (Instructor)</label>
                            <input type="text" id="instructor"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì†Œì† ë° ì„±ëª…">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ë¬¸ì˜ì²˜ (Contact)</label>
                            <input type="text" id="contact"
                                class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                                placeholder="ì˜ˆ: ê¸°ì—…ì§€ì›ë¶€ (053-222-3109)">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">êµìœ¡ë¹„ ì•ˆë‚´ (Payment Info)</label>
                        <textarea id="paymentInfo" rows="2"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: ë¬´ë£Œ (êµì¬ ë° ìˆ˜ë£Œì¦ ì œê³µ)"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ê¸°íƒ€ ì•ˆë‚´ (Other Info)</label>
                        <textarea id="otherInfo" rows="2"
                            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500"
                            placeholder="ì˜ˆ: ì£¼ì°¨ì¥ì´ í˜‘ì†Œí•˜ì˜¤ë‹ˆ ëŒ€ì¤‘êµí†µì„ ì´ìš©í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤."></textarea>
                    </div>

                    <div class="pt-6 border-t flex justify-end">
                        <button type="button" id="btn-submit" onclick="submitCourse()"
                            class="px-8 py-3 bg-blue-900 text-white font-bold rounded-xl shadow hover:bg-blue-800 transition-colors transform hover:-translate-y-0.5">
                            ê³¼ì • ë“±ë¡í•˜ê¸°
                        </button>
                    </div>

                </form>
            </div>

            <!-- ì„¹ì…˜ 3: êµìœ¡ ê³¼ì • ê´€ë¦¬ (ìˆ˜ì •/ì‚­ì œ) -->
            <div id="section-manage" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">ğŸ› ï¸ êµìœ¡ ê³¼ì • ê´€ë¦¬</h2>
                        <p class="text-sm text-gray-500 mt-1">ë“±ë¡ëœ êµìœ¡ ê³¼ì •ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="fetchManage()"
                        class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-bold">
                        â†» ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>

                <div class="overflow-x-auto border rounded-xl">
                    <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
                        <thead class="bg-gray-50">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ê³¼ì •ëª…</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ì¼ì‹œ</th>
                                <th
                                    class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="manage-body" class="bg-white divide-y divide-gray-200 text-sm">
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbz1PWE-smF4alEMayWn_5WfLWuw6xprd3SDlFX8FinpvdZ6vEz5BI6dzD-mWrWxuWdy/exec';
        let allCourses = {}; // ë°ì´í„° ì €ì¥ìš©
        let editingCourseId = null; // í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ID

        // ì´ˆê¸° ë¡œë“œ ì‹œ í˜„í™© ì¡°íšŒ
        window.onload = function () {
            fetchStatus();
        };

        function switchTab(tabId) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            ['register', 'status', 'manage'].forEach(id => {
                const btn = document.getElementById('tab-' + id);
                if (btn) {
                    btn.className = "py-2 px-4 text-gray-500 font-medium hover:text-gray-700 focus:outline-none transition-colors";
                    btn.classList.remove('border-b-2', 'border-blue-600', 'text-blue-600', 'font-bold');
                }
                const section = document.getElementById('section-' + id);
                if (section) section.classList.add('hidden');
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            const activeHeader = document.getElementById('tab-' + tabId);
            if (activeHeader) {
                activeHeader.classList.remove('text-gray-500', 'font-medium');
                activeHeader.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'font-bold');
            }

            const activeSection = document.getElementById('section-' + tabId);
            if (activeSection) activeSection.classList.remove('hidden');

            if (tabId === 'status') fetchStatus();
            if (tabId === 'manage') fetchManage();
        }

        // --- ê¸°ëŠ¥ 1: ê³¼ì • ë“±ë¡/ìˆ˜ì • ---
        function submitCourse() {
            const btn = document.getElementById('btn-submit');
            const originalText = btn.innerText;
            const pwd = document.getElementById('adminPassword').value;

            if (!pwd) return alert('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            const actionType = editingCourseId ? "ìˆ˜ì •" : "ë“±ë¡";
            if (!confirm(`ì´ëŒ€ë¡œ êµìœ¡ ê³¼ì •ì„ ${actionType}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

            btn.innerText = "ì²˜ë¦¬ ì¤‘...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append('action', editingCourseId ? 'update_course' : 'add_course');
            if (editingCourseId) formData.append('id', editingCourseId);
            formData.append('password', pwd);

            // ë°ì´í„° ë§¤í•‘
            ['category', 'title', 'date', 'place', 'capacity', 'deadline', 'target', 'goal', 'content', 'instructor', 'contact', 'paymentInfo', 'otherInfo'].forEach(field => {
                const el = document.getElementById(field);
                if (el) formData.append(field, el.value);
            });

            const data = new URLSearchParams(formData);

            fetch(scriptURL, { method: 'POST', body: data })
                .then(response => response.json())
                .then(result => {
                    if (result.result === 'success') {
                        alert(`âœ… êµìœ¡ ê³¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ${actionType}ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                        if (editingCourseId) cancelEdit(); // ìˆ˜ì • ëª¨ë“œ ì¢…ë£Œ
                        else {
                            document.getElementById('courseForm').reset();
                            document.getElementById('adminPassword').value = pwd; // ë¹„ë°€ë²ˆí˜¸ëŠ” ìœ ì§€ í¸ì˜ì„±
                        }
                    } else {
                        alert(`â›” ${actionType} ì‹¤íŒ¨: ` + result.msg);
                    }
                    btn.innerText = originalText;
                    btn.disabled = false;
                })
                .catch(error => {
                    alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    console.error(error);
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
        }

        // --- ê¸°ëŠ¥ 2: ì‹ ì²­ì í˜„í™© ì¡°íšŒ ---
        function fetchStatus() {
            const tbody = document.getElementById('status-body');
            tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center text-blue-600 font-bold"><span class="animate-pulse">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span></td></tr>';

            fetch(scriptURL)
                .then(response => response.json())
                .then(data => renderStatusTable(data, tbody))
                .catch(err => handleError(tbody, err));
        }

        function renderStatusTable(data, tbody) {
            tbody.innerHTML = '';
            if (data.result === 'error') {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500 font-bold">ì˜¤ë¥˜: ${data.msg}</td></tr>`;
                return;
            }

            const now = new Date();
            let hasData = false;

            // 1. ë‚ ì§œìˆœ ì •ë ¬ (ì˜¤ë¦„ì°¨ìˆœ)
            const courses = Object.keys(data).map(key => data[key]).sort((a, b) => {
                const parseDate = (str) => {
                    try {
                        const parts = str.match(/(\d{4})[\.\s]+(\d{1,2})[\.\s]+(\d{1,2})/);
                        if (parts) return new Date(`${parts[1]}-${parts[2]}-${parts[3]}`);
                        return new Date(9999, 11, 31); // íŒŒì‹± ì‹¤íŒ¨ì‹œ ë’¤ë¡œ
                    } catch (e) { return new Date(9999, 11, 31); }
                };
                return parseDate(a.date) - parseDate(b.date);
            });

            if (courses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            courses.forEach(item => {
                let statusBadge = `<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded-full">ì ‘ìˆ˜ì¤‘</span>`;
                const cap = parseInt(item.capacity || 0);
                const cur = parseInt(item.current || 0);

                if (cap > 0 && cur >= cap) statusBadge = `<span class="px-2 py-1 bg-gray-100 text-gray-500 text-xs font-bold rounded-full">ì •ì›ë§ˆê°</span>`;

                if (item.deadline) {
                    const deadlineDate = new Date(item.deadline);
                    deadlineDate.setHours(23, 59, 59, 999);
                    if (now > deadlineDate) statusBadge = `<span class="px-2 py-1 bg-gray-100 text-gray-500 text-xs font-bold rounded-full">ê¸°í•œë§ˆê°</span>`;
                }

                // ì‹ ì²­ì ëª…ë‹¨ HTML ìƒì„± (J~Mì—´ ì¶”ê°€)
                let applicantsHtml = '';
                if (item.applicants && item.applicants.length > 0) {
                    applicantsHtml = `
                        <div class="bg-gray-50 p-4 rounded-lg m-4 border border-gray-200">
                            <h4 class="font-bold text-gray-700 mb-2">ğŸ“‹ ì‹ ì²­ì ëª…ë‹¨ (${item.applicants.length}ëª…)</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full text-xs text-left text-gray-500">
                                    <thead class="bg-gray-100 text-gray-700 font-bold border-b">
                                        <tr>
                                            <th class="px-3 py-2 whitespace-nowrap">ì‹œê°„</th>
                                            <th class="px-3 py-2 whitespace-nowrap">íšŒì‚¬ëª…</th>
                                            <th class="px-3 py-2 whitespace-nowrap">ì‚¬ì—…ìë²ˆí˜¸</th>
                                            <th class="px-3 py-2 whitespace-nowrap">ë¶€ì„œ/ì§ìœ„</th>
                                            <th class="px-3 py-2 whitespace-nowrap">ì„±ëª…</th>
                                            <th class="px-3 py-2 whitespace-nowrap">ì—°ë½ì²˜</th>
                                            <th class="px-3 py-2 whitespace-nowrap">ì´ë©”ì¼</th>
                                            <th class="px-3 py-2 whitespace-nowrap bg-yellow-50">ê°œì¸ì •ë³´</th>
                                            <th class="px-3 py-2 whitespace-nowrap bg-yellow-50">íšŒì›êµ¬ë¶„</th>
                                            <th class="px-3 py-2 whitespace-nowrap bg-yellow-50">íšŒë¹„ë‚©ë¶€</th>
                                            <th class="px-3 py-2 whitespace-nowrap bg-yellow-50">ì˜ì›êµ¬ë¶„</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        ${item.applicants.map(app => `
                                            <tr class="hover:bg-blue-50">
                                                <td class="px-3 py-2 whitespace-nowrap">${app.timestamp}</td>
                                                <td class="px-3 py-2 whitespace-nowrap font-medium text-gray-900">${app.bizName}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${app.bizNo}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${app.dept} ${app.position}</td>
                                                <td class="px-3 py-2 whitespace-nowrap font-bold text-gray-900">${app.name}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${app.phone}</td>
                                                <td class="px-3 py-2 whitespace-nowrap">${app.email}</td>
                                                
                                                <!-- ì¶”ê°€ ì»¬ëŸ¼ J~M (ë°°ê²½ìƒ‰ êµ¬ë¶„) -->
                                                <td class="px-3 py-2 whitespace-nowrap bg-yellow-50 text-gray-600">${app.privacy}</td>
                                                <td class="px-3 py-2 whitespace-nowrap bg-yellow-50 font-semibold text-blue-600">${app.memberType || '-'}</td>
                                                
                                                <td class="px-3 py-2 whitespace-nowrap bg-yellow-50 font-bold ${(app.feeStatus === 'ë¯¸ë‚©' || app.feeStatus === 'ë©´ì œ') ? 'text-red-500' : 'text-green-600'
                        }">${app.feeStatus || '-'}</td>
                                                
                                                <td class="px-3 py-2 whitespace-nowrap bg-yellow-50 text-gray-700">${app.councilType || '-'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>`;
                } else {
                    applicantsHtml = `<div class="p-6 text-center text-gray-400">ì‹ ì²­ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                }

                tbody.innerHTML += `
                    <tr class="hover:bg-blue-50 cursor-pointer transition-colors border-b" onclick="toggleApplicantList('${item.id}')">
                        <td class="px-6 py-4">${statusBadge}</td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-bold text-gray-900 flex items-center">
                                ${item.title}
                                <svg id="icon-${item.id}" class="w-4 h-4 ml-2 text-gray-400 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                            <div class="text-xs text-gray-500">${item.category}</div>
                        </td>
                        <td class="px-6 py-4 text-gray-500 text-sm">${item.date}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="w-full bg-gray-200 rounded-full h-2.5 mr-2 max-w-[100px]">
                                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${cap > 0 ? Math.min((cur / cap) * 100, 100) : 0}%"></div>
                                </div>
                                <span class="text-sm font-bold text-gray-700">${cur} / ${cap > 0 ? cap : '-'}ëª…</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-gray-500 text-sm">${item.deadline ? item.deadline.split('T')[0] : 'ìƒì‹œ/ë³„ë„'}</td>
                    </tr>
                    <tr id="detail-${item.id}" class="hidden bg-gray-50 border-b">
                        <td colspan="5" class="p-0">
                            ${applicantsHtml}
                        </td>
                    </tr>`;
            });
        }

        function toggleApplicantList(id) {
            const detailRow = document.getElementById(`detail-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            if (detailRow) {
                detailRow.classList.toggle('hidden');
                if (icon) {
                    icon.classList.toggle('rotate-180');
                }
            }
        }

        // --- ê¸°ëŠ¥ 3: ê´€ë¦¬ (ìˆ˜ì •/ì‚­ì œ) ---
        function fetchManage() {
            const tbody = document.getElementById('manage-body');
            tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-10 text-center text-blue-600 font-bold"><span class="animate-pulse">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span></td></tr>';

            fetch(scriptURL)
                .then(response => response.json())
                .then(data => {
                    allCourses = data; // ë°ì´í„° ì „ì—­ ì €ì¥
                    renderManageTable(data, tbody);
                })
                .catch(err => {
                    console.error("Error fetching for manage:", err);
                    tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-10 text-center text-red-500">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</td></tr>';
                });
        }

        function renderManageTable(data, tbody) {
            tbody.innerHTML = '';
            const courses = Object.keys(data).map(key => data[key]);

            if (courses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-10 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            courses.forEach(item => {
                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="text-sm font-bold text-gray-900">${item.title}</div>
                            <div class="text-xs text-gray-500">${item.category}</div>
                        </td>
                        <td class="px-6 py-4 text-gray-500 text-sm">${item.date}</td>
                        <td class="px-6 py-4 text-center whitespace-nowrap">
                            <button onclick="loadCourseForEdit('${item.id}')" class="text-blue-600 hover:text-blue-900 font-bold mr-2 border border-blue-200 px-3 py-1 rounded hover:bg-blue-50 transition-colors">ìˆ˜ì •</button>
                            <button onclick="deleteCourse('${item.id}')" class="text-red-600 hover:text-red-900 font-bold border border-red-200 px-3 py-1 rounded hover:bg-red-50 transition-colors">ì‚­ì œ</button>
                        </td>
                    </tr>`;
            });
        }

        // ìˆ˜ì • ëª¨ë“œ ì§„ì…
        function loadCourseForEdit(id) {
            const data = allCourses[id];
            if (!data) return alert('ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

            editingCourseId = id;

            // íƒ­ ì „í™˜
            switchTab('register');

            // í¼ ì±„ìš°ê¸°
            document.getElementById('category').value = data.category;
            document.getElementById('title').value = data.title;
            document.getElementById('date').value = data.date;
            document.getElementById('place').value = data.place;
            document.getElementById('capacity').value = data.capacity;
            document.getElementById('deadline').value = data.deadline ? data.deadline.split('T')[0] : '';
            document.getElementById('target').value = data.target;
            document.getElementById('goal').value = data.goal;
            document.getElementById('content').value = data.content;
            document.getElementById('instructor').value = data.instructor;
            document.getElementById('contact').value = data.contact;
            document.getElementById('paymentInfo').value = data.paymentInfo;
            document.getElementById('otherInfo').value = data.otherInfo;

            // UI ë³€ê²½
            document.getElementById('edit-header').classList.remove('hidden');
            document.getElementById('edit-course-title').innerText = data.title;
            document.getElementById('btn-submit').innerText = 'êµìœ¡ ê³¼ì • ìˆ˜ì •í•˜ê¸°';
            document.getElementById('btn-submit').classList.remove('bg-blue-900', 'hover:bg-blue-800');
            document.getElementById('btn-submit').classList.add('bg-yellow-600', 'hover:bg-yellow-500');

            window.scrollTo(0, 0);
        }

        // ìˆ˜ì • ì·¨ì†Œ
        function cancelEdit() {
            editingCourseId = null;
            document.getElementById('courseForm').reset();
            document.getElementById('edit-header').classList.add('hidden');

            const btn = document.getElementById('btn-submit');
            btn.innerText = 'êµìœ¡ ê³¼ì • ë“±ë¡í•˜ê¸°';
            btn.classList.remove('bg-yellow-600', 'hover:bg-yellow-500');
            btn.classList.add('bg-blue-900', 'hover:bg-blue-800');
        }

        // ì‚­ì œ
        function deleteCourse(id) {
            const pwd = prompt("ì‚­ì œí•˜ë ¤ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            if (!pwd) return;

            if (!confirm("ì •ë§ë¡œ ì´ ê³¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

            const formData = new FormData();
            formData.append('action', 'delete_course');
            formData.append('id', id);
            formData.append('password', pwd);

            fetch(scriptURL, { method: 'POST', body: new URLSearchParams(formData) })
                .then(response => response.json())
                .then(result => {
                    if (result.result === 'success') {
                        alert('ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        fetchManage(); // ëª©ë¡ ê°±ì‹ 
                    } else {
                        alert('â›” ì‚­ì œ ì‹¤íŒ¨: ' + result.msg);
                    }
                })
                .catch(err => alert('ì˜¤ë¥˜ ë°œìƒ: ' + err));
        }

        function handleError(tbody, err) {
            console.error(err);
            tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</td></tr>`;
        }

    </script>
</body>

</html>